<div class="dashboard-page">

  <div class="home-navbar" id="navbar">
    <%= link_to :root, class: 'navbar-brand' do %>
      <%= image_tag "logo-resize-2", class: "subscripto-logo" %>
    <% end %>
      <ul class='underline-menu'>
        <li class='nav-item'>
          <%= link_to 'Help', root_path, class: 'nav-link'%>
        </li>
        <li class='nav-item'>
          <%= link_to 'Scan My Account', transactions_path, class: 'nav-link'%>
        </li>
        <% if current_user.nil? %>
          <li class='nav-item'>
            <%= link_to 'Sign up', '/users/sign_up', class: 'nav-link' %>
          </li>
          <li class='nav-item'>
            <%= link_to 'Log in', new_user_session_path, class: 'nav-link' %>
          </li>
        <% else %>
          <li class='nav-item'>
            <%= link_to 'My Subscriptions', subscriptions_path, class: 'nav-link' %>
          </li>
          <li class='nav-item'>
            <%= link_to 'Log out', destroy_user_session_path, method: :delete, class: 'nav-link' %>
          </li>
        <% end %>
      </ul>
  </div>

  <div class="dashboard-header">
    <button type="button" class="btn" data-toggle="modal" data-target="#myModal">Add a Subscription <i class="fas fa-plus"></i></button>
  </div>

  <div class="dashboard-container">

    <div class="activity-sidebar">
      <div class="price-average">
        <h5><strong>How much you said?</strong></h5>
        <h6>Lifetime average</h6>
        <h6>Monthly average</h6>
      </div>


      <div class="top-subscriptions">
       <h5><strong>My oldest subscriptions</strong></h5>
        <h6></h6>
      </div>
    </div>

      <div class="index-container">
        <div class="chart-container" style="width: 800px; margin: 0 auto;">
          <h5>My Activity</h5>
          <canvas id="myChart"></canvas>
          <div class="total-billing">
            <% subscriptions = Subscription.all %>
              <% price_array = subscriptions.map do |s| %>
              <% s.price %>
            <% end %>
            <% total = price_array.sum %>
            <strong><%="Next Month Bill: $#{total.round(2)}"%></strong>
          <div>
        </div>
      </div>

      <!-- Large modal -->
      <div class="cards-container">
        <div class="modal fade" id='myModal' tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <div class="d-flex justify-content-center">
                  <h2>Add Subscription</h2>
                  </div>
                  <div class="d-flex justify-content-right">
                    <button type="button" class="btn btn-default" data-dismiss="modal" data-target="#myModal"><i class="fas fa-times"></i></button>
                  </div>
                  <div class="modal-body">
                    <div class="subscription-container">
                      <%= simple_form_for Subscription.new do |f| %>
                        <%= f.input :title %>
                        <%= f.input :price %>
                        <%= f.input :creation_date %>
                        <%= f.input :renewal_date %>
                        <%= f.button :submit, class: "btn btn-warning" %>
                      <% end %>
                    </div>
                  </div>
                  <div class="modal-footer">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="user-subs" style="margin: 30px;">
        <div class="subscriptions-box" style="width: 800px; margin: 0 auto;">
          <h5>My Subscriptions</h5>
          <% @subscriptions.each do |subscription| %>
            <div class="subscription-card">
              <div class="subscription-card-info">
                <h2><%= subscription.title %></h2>
                <% date1 = subscription.creation_date %>
                <% date2 = Date.today %>
                <% months = (date2.year * 12 + date2.month) - (date1.year * 12 + date1.month) %>
                <p>Total Spent: £ <%= all_time_total = months * subscription.price %> </p>
                <% date1 = subscription.creation_date %>
                <% date2 = Date.today %>
                <% months = (date2.year * 12 + date2.month) - (date1.year * 12 + date1.month) %>
                <p> Time:<%= months / 12 %> Years <%= months % 12 %> Months </p>
              </div>
              <h2 class="card-trip-pricing">Price: £<%= subscription.price %></h2>
              <img src="https://logo.clearbit.com/<%= subscription.title.split(' ').first.downcase %>.com" class="card-trip-user">
              <button class="manage-button">
                <%= link_to 'Manage', subscription_path(subscription) %>
              </button>
            </div>
          <% end %>
        </div>
      </div>

  </div>

</div>



