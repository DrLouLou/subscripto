<!-- <h1><%= @access_token %></h1>
<%= link_to root_path do %>
  <button>Home</button>
<% end %> -->

<div class="dashboard-header">
  <div>
    <button><%= link_to root_path do %> Subscripto <% end %></button>
    <button><%= link_to transactions_path do %> Scan My Account <% end %></button>
  </div>
  <button type="button" class="btn" data-toggle="modal" data-target="#myModal">Add a Subscription <i class="fas fa-plus"></i></button>
</div>

 <div class="index-container">
    <div class="chart-container">
      <canvas id="myChart"></canvas>
    </div>
    <% subscriptions = Subscription.all %>
    <% price_array = subscriptions.map do |s| %>
      <% s.price %>
    <% end %>
    <% total = price_array.sum %>

    <div class="total-billing">
      <strong><%="Next Month Bill: $#{total.round(2)}"%></strong>
    <div>
  </div>

  <div class="dashboard-container">
  <!-- Large modal -->
    <div class="cards-container">

      <div class="modal fade" id='myModal' tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <div class="d-flex justify-content-center">
                <h2>Add Subscription</h2>
              </div>
              <div class="d-flex justify-content-right">
                <button type="button" class="btn btn-default" data-dismiss="modal" data-target="#myModal"><i class="fas fa-times"></i></button>
              </div>
            </div>
            <div class="modal-body">
              <div class="subscription-container">
                <%= simple_form_for Subscription.new do |f| %>
                  <%= f.input :title %>
                  <%= f.input :price %>
                  <%= f.input :creation_date %>
                  <%= f.input :renewal_date %>
                  <%= f.button :submit, class: "btn btn-warning" %>
                <% end %>
              </div>
            </div>
            <div class="modal-footer">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="subscriptions-box">
    <h5>Your Subscriptions</h5>
    <% @subscriptions.each do |subscription| %>
      <div class="subscription-card">
        <div class="subscription-card-info">
          <h2><%= subscription.title %></h2>
          <% date1 = subscription.creation_date %>
          <% date2 = Date.today %>
          <% months = (date2.year * 12 + date2.month) - (date1.year * 12 + date1.month) %>
          <p>Total Spent: £ <%= all_time_total = months * subscription.price %> </p>
          <% date1 = subscription.creation_date %>
          <% date2 = Date.today %>
          <% months = (date2.year * 12 + date2.month) - (date1.year * 12 + date1.month) %>
          <p> Time:<%= months / 12 %> Years <%= months % 12 %> Months </p>
        </div>
        <h2 class="card-trip-pricing">Price: £<%= subscription.price %></h2>
        <img src="https://logo.clearbit.com/<%= subscription.title.split(' ').first.downcase %>.com" class="card-trip-user">
        <button class="manage-button">
          <%= link_to 'Manage', subscription_path(subscription) %>
        </button>
      </div>
    <% end %>
  </div>
</div>


